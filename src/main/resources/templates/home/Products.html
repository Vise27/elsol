
<div class="container-fluid pt-5 pb-3">
  <!-- Título centrado -->
  <h2 class="section-title position-relative text-uppercase mx-xl-5 mb-4">
    <span class="bg-secondary pr-3 pl-3">Productos</span>
  </h2>

  <div class="row justify-content-center px-xl-5">
    <th:block th:each="producto : ${productos}">
      <div class="col-lg-3 col-md-4 col-sm-6 pb-1">
        <div class="product-item bg-light mb-4">
          <!-- Contenedor del producto ahora como un enlace -->
          <a th:href="@{/home/producto/detalle/{codigo}(codigo=${producto.codigo})}">
            <div class="product-img position-relative overflow-hidden">
              <div class="image-container">
                <img class="product-image" th:src="${producto.imagen}" alt="Imagen de [[${producto.nombre}]]">
              </div>
            </div>

            <div class="text-center py-4">
              <h5 th:text="${producto.nombre}"></h5>
              <div class="d-flex align-items-center justify-content-center mt-2">
                <h5 th:text="'S/' + ${producto.precio}"></h5>
              </div>
              <p class="text-muted small" th:text="'Stock: ' + ${producto.stock} + ' unidades disponibles'"></p>
            </div>
          </a>

          <!-- Formulario para agregar al carrito -->
          <form onsubmit="agregarProducto(event, this)" method="post">
            <input type="hidden" name="productoCodigo" th:value="${producto.codigo}" />

            <div class="add-to-cart-container">
              <div class="quantity-input">
                <button type="button" class="btn btn-sm" th:disabled="${producto.stock == 0}" onclick="this.nextElementSibling.stepDown()">-</button>
                <input type="number" name="cantidad" value="1" min="1" max="${producto.stock}" class="form-control" required />
                <button type="button" class="btn btn-sm" th:disabled="${producto.stock == 0}" onclick="this.previousElementSibling.stepUp()">+</button>
              </div>
              <button type="submit" class="btn btn-outline-dark btn-square mt-3">
                <i class="fa fa-shopping-cart"></i> Agregar al carrito
              </button>
            </div>
          </form>
        </div>
      </div>
    </th:block>
  </div>
</div>

<script>
  function agregarProducto(event, form) {
    event.preventDefault(); // Evita que el formulario se envíe de manera tradicional

    const formData = new FormData(form); // Extrae los datos del formulario

    fetch('/carrito/agregar', {
      method: 'POST',
      body: new URLSearchParams(formData), // Convierte FormData en una consulta URL
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded', // Configura el encabezado
      },
    })
    .then(response => response.json())
    .then(data => {
      // Mostrar una notificación basada en la respuesta
      alert(data.message);
    })
    .catch(error => {
      console.error('Error al agregar producto:', error);
      alert('Ocurrió un error al agregar el producto al carrito.');
    });
  }
</script>
</body>

</html>
